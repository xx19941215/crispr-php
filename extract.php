<?php 

$file_path = "/Users/xiao/Downloads/gyy/data/GCF_000240185.1_ASM24018v2_genomic.gbff";
$out_path = "/Users/xiao/Downloads/gyy/data/out.txt";

$string = file_get_contents($file_path);

// $string = preg_replace('/\s+/i', '', $string);

$matches = [];

// $preg = '#CDS(\s|[\r\n])+(.*)(\s|[\r\n])+/(locus_tag="(.*)")(\s|[\r\n])+/(.*?)(\s|[\r\n])+/(.*?)(\s|[\r\n])+/(product="(.*)")#';
$preg = '#CDS(\s|[\r\n])+(.*)(\s|[\r\n])+/(locus_tag="([\s\S]*?)")(\s|[\r\n])+/(.*?)(\s|[\r\n])+/(.*?)(\s|[\r\n])+/(product="[\s\S]*?")#';


preg_match_all($preg, $string, $matches);

// var_dump($matches[4]);
// var_dump($matches[10]);

$kphs = [
"KPHS_00030",
"KPHS_00090",
"KPHS_00520",
"KPHS_00550",
"KPHS_00730",
"KPHS_00920",
"KPHS_01690",
"KPHS_01700",
"KPHS_02580",
"KPHS_02600",
"KPHS_02690",
"KPHS_03280",
"KPHS_03290",
"KPHS_03300",
"KPHS_04280",
"KPHS_04720",
"KPHS_04970",
"KPHS_04980",
"KPHS_04990",
"KPHS_05220",
"KPHS_05230",
"KPHS_05240",
"KPHS_05260",
"KPHS_05280",
"KPHS_05290",
"KPHS_05300",
"KPHS_05310",
"KPHS_06200",
"KPHS_06210",
"KPHS_06220",
"KPHS_06320",
"KPHS_06580",
"KPHS_06590",
"KPHS_06600",
"KPHS_06610",
"KPHS_06750",
"KPHS_06850",
"KPHS_06860",
"KPHS_07150",
"KPHS_07160",
"KPHS_09460",
"KPHS_09610",
"KPHS_09880",
"KPHS_09920",
"KPHS_09980",
"KPHS_10320",
"KPHS_10330",
"KPHS_10340",
"KPHS_10350",
"KPHS_10490",
"KPHS_10500",
"KPHS_11210",
"KPHS_12030",
"KPHS_13090",
"KPHS_13180",
"KPHS_13190",
"KPHS_14100",
"KPHS_14110",
"KPHS_14560",
"KPHS_14570",
"KPHS_14580",
"KPHS_14590",
"KPHS_14730",
"KPHS_14750",
"KPHS_14760",
"KPHS_14770",
"KPHS_14780",
"KPHS_14790",
"KPHS_14890",
"KPHS_15890",
"KPHS_16060",
"KPHS_16070",
"KPHS_16080",
"KPHS_16110",
"KPHS_16120",
"KPHS_16210",
"KPHS_16220",
"KPHS_16230",
"KPHS_16240",
"KPHS_17020",
"KPHS_17550",
"KPHS_17560",
"KPHS_17980",
"KPHS_19170",
"KPHS_19180",
"KPHS_19190",
"KPHS_19260",
"KPHS_19270",
"KPHS_20290",
"KPHS_21920",
"KPHS_24070",
"KPHS_24130",
"KPHS_25370",
"KPHS_26190",
"KPHS_26200",
"KPHS_26290",
"KPHS_26300",
"KPHS_26310",
"KPHS_26320",
"KPHS_26330",
"KPHS_26340",
"KPHS_26350",
"KPHS_26360",
"KPHS_26370",
"KPHS_27980",
"KPHS_28000",
"KPHS_28010",
"KPHS_28020",
"KPHS_28080",
"KPHS_29390",
"KPHS_30020",
"KPHS_30390",
"KPHS_30400",
"KPHS_30410",
"KPHS_30700",
"KPHS_31430",
"KPHS_31440",
"KPHS_31450",
"KPHS_32430",
"KPHS_32440",
"KPHS_32930",
"KPHS_32940",
"KPHS_32950",
"KPHS_32960",
"KPHS_33350",
"KPHS_34580",
"KPHS_35200",
"KPHS_35850",
"KPHS_36360",
"KPHS_36630",
"KPHS_36640",
"KPHS_36650",
"KPHS_36710",
"KPHS_37110",
"KPHS_37120",
"KPHS_37130",
"KPHS_37140",
"KPHS_37150",
"KPHS_37620",
"KPHS_38280",
"KPHS_38400",
"KPHS_38410",
"KPHS_38950",
"KPHS_38960",
"KPHS_39770",
"KPHS_41190",
"KPHS_41200",
"KPHS_41210",
"KPHS_41280",
"KPHS_41290",
"KPHS_41310",
"KPHS_41320",
"KPHS_41330",
"KPHS_41340",
"KPHS_41350",
"KPHS_41360",
"KPHS_41370",
"KPHS_41390",
"KPHS_41900",
"KPHS_41920",
"KPHS_41930",
"KPHS_41940",
"KPHS_42410",
"KPHS_43170",
"KPHS_44170",
"KPHS_44440",
"KPHS_45830",
"KPHS_46120",
"KPHS_46150",
"KPHS_46160",
"KPHS_46170",
"KPHS_46180",
"KPHS_46190",
"KPHS_46200",
"KPHS_46210",
"KPHS_46220",
"KPHS_46230",
"KPHS_46240",
"KPHS_46250",
"KPHS_46270",
"KPHS_46280",
"KPHS_46290",
"KPHS_46350",
"KPHS_46360",
"KPHS_46370",
"KPHS_46410",
"KPHS_46520",
"KPHS_46530",
"KPHS_46540",
"KPHS_47750",
"KPHS_49440",
"KPHS_49790",
"KPHS_50550",
"KPHS_50630",
"KPHS_51050",
"KPHS_51160",
"KPHS_51760",
"KPHS_51770",
"KPHS_52240",
"KPHS_52530",
"KPHS_52540",
"KPHS_52630",
];

// var_dump($matches[5]);
// die();
foreach ($matches[5] as $index => $tag) {
    if (in_array($tag, $kphs)) {
        $item = $matches[4][$index] . "," .  $matches[11][$index];
        logger($item, $out_path);
    }
    
} 


function logger($logthis, $path)
{
    echo $logthis . PHP_EOL;
    file_put_contents($path, $logthis. "\r\n", FILE_APPEND | LOCK_EX);
}